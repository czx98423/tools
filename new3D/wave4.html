<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
  <title>Shader wave</title>
  <style>
    html, body {
      margin: 0px;
      overflow: hidden;
      height: 100%;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>
  <script type="module">
    import {
      Scene, vec3, Data, Animate, createGUI,
    } from './bundle.js'
    import FlowLightingMaterial from './js/FlowLightingMaterial.js'

    const scene = new Scene({
      canvas: 'canvas',
      camera: {
        near: 0.1,
        far: 20,
        position: vec3.fromValues(0, 3.5, 9),
      },
    });

    const createBaseAnimate = ({
      todo, time = 3000, repeat = 1, reverse = false,c
    }) => new Animate({
      from: 0,
      to: 0.5,
      repeat,
      reverse,
      dur: time,
      onUpdate(value) {
        todo(value);
      },
    });

    const plane = scene.add({
      type: 'plane',
      rx: -Math.PI / 2,
      scale: vec3.fromValues(10, 10, 10),
      material: {
        diffuseImage: './images/plane.png',
        transparent: true,
        doubleSided: true,
      },
    });

    function createNode(ratio) {
      const cube = new Data({
        type: 'plane',
        material: new FlowLightingMaterial(),
        parent: plane,
      });

      cube.animate = createBaseAnimate({
        time: 5000,
        todo: (value) => {
          cube.material.time = (value + ratio) % 0.5;
        },
        repeat: Number.POSITIVE_INFINITY,
      });
      scene.add(cube);
      return cube;
    }

    for (let i = 0; i < 5; i++) {
      createNode(i / 5);
    }

    plane.children.forEach((child) => child.animate.play());
    createGUI(scene);

    scene.add({
      type: 'cube',
      y: -1,
    });
  </script>
</body>
</html>